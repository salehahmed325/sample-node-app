# Use a lighter base image
FROM node:16-alpine

# Create and set the working directory
WORKDIR /usr/src/app

# Install app dependencies
COPY package*.json ./
RUN npm install --production

# Bundle app source
COPY . .

# Install pm2 globally and clean up
RUN npm install -g pm2 && \
    npm cache clean --force && \
    rm -rf /tmp/*

# Expose the port
EXPOSE 3000

# Start the application using pm2
CMD ["pm2", "start", "server.js", "--watch"]